/*!
 * CxProxy.jquery.js
 *
 * Adds a useCxProxy option to $.ajax calls, which parses the API call to be
 * handled by the Carerix app's proxy server, thereby preventing the issue of
 * CrossDomain requests.
 *
 * @author	J. Stafleu <jstafleu@jcgroep.nl>
 * @created	01 november 2012
 */
(function(c){c.ajaxPrefilter(function(g,k,i){if(g.useCxProxy){var f=g.url.split("/"),e=f[0]+"//",d=f.slice(2,5),h,j=[];for(h=5;h<f.length;h+=2){j.push(f[h]+"="+f[h+1]);}if(g.data){j.push(g.data);}g.data=j.join("&");g.url=e+document.URL.substr(document.URL.indexOf("://")+3,document.URL.indexOf(".")-document.URL.indexOf("://")-3)+".carerix.net/cgi-bin/nph-proxy.cgi/h0/"+e.replace("://","")+"/"+g.username+":"+g.password+"@"+d.join("/");delete g.username;delete g.password;g.traditional=true;}});c.cxXml2Json=function a(e){if(e.nodeType===3){return e.nodeValue;}var d={},g,f;if(e.attributes&&e.attributes.length){d["@attributes"]={};for(f=0;f<e.attributes.length;f++){g=e.attributes.item(f);d["@attributes"][g.nodeName]=g.nodeValue;}}c(e).contents().each(function(){if(typeof(parsed=a(this))===typeof""&&c.trim(parsed)===""){return;}switch(true){case typeof this.tagName===typeof undefined:d=parsed;return false;case typeof d[this.tagName]===typeof undefined:d[this.tagName]=parsed;break;case !c.isArray(d[this.tagName]):d[this.tagName]=[d[this.tagName]];case c.isArray(d[this.tagName]):d[this.tagName].push(parsed);break;}});return d;};c.cxXml2Json_flat=function(d){var g="",f="",e={};obj=c.cxXml2Json(d);for(g in obj){break;}e.count=parseInt(obj[g]["@attributes"].count);for(f in obj[g]){if(f!=="@attributes"){break;}}e.rows=b(obj[g]);e.success=true;return e;};function b(h){var g="",e="",d={},f;if(typeof h["@attributes"]!==typeof undefined){if(typeof h["@attributes"]["id"]!==typeof undefined){d.id=h["@attributes"]["id"];}if(typeof h["@attributes"]["entity"]!==typeof undefined){d.id=h["@attributes"]["entity"];}}for(g in h){if(g==="@attributes"||typeof h[g]===typeof function(){}){continue;}else{if(g.indexOf("CR")===0){if(h["@attributes"]&&h["@attributes"].count){if(!c.isArray(h[g])){d=[b(h[g])];}else{d=[];for(e=0;e<h[g].length;e++){f=b(h[g][e]);d.push(f);}}}else{d=b(h[g]);d.entity=g;}}else{if(typeof h[g]===typeof{}){d[g]=b(h[g]);}else{d[g]=h[g];}}}}return d;}})(jQuery);